From 3930d7abeb96029bc1431901729e0a3cfb1c797a Mon Sep 17 00:00:00 2001
From: hubicka <hubicka@138bc75d-0d04-0410-961f-82ee72b054a4>
Date: Thu, 22 May 2014 05:35:32 +0000
Subject: [PATCH] 	PR lto/61012
 	* lto-symtab.c (lto_symtab_merge_decls_1):

git-svn-id: svn+ssh://gcc.gnu.org/svn/gcc/branches/gcc-4_9-branch@210739 138bc75d-0d04-0410-961f-82ee72b054a4
---
 gcc/lto/ChangeLog    |    5 +++++
 gcc/lto/lto-symtab.c |    7 ++++++-
 2 files changed, 11 insertions(+), 1 deletions(-)

diff --git a/gcc/lto/ChangeLog b/gcc/lto/ChangeLog
index b396e48..47a5924 100644
--- a/gcc/lto/ChangeLog
+++ b/gcc/lto/ChangeLog
@@ -1,3 +1,8 @@
+2014-04-22  Jan Hubicka  <hubicka@ucw.cz>
+
+	PR lto/61012
+	* lto-symtab.c (lto_symtab_merge_decls_1):
+
 2014-04-22  Release Manager
 
 	* GCC 4.9.0 released.
diff --git a/gcc/lto/lto-symtab.c b/gcc/lto/lto-symtab.c
index 71242c8..e77448e 100644
--- a/gcc/lto/lto-symtab.c
+++ b/gcc/lto/lto-symtab.c
@@ -453,7 +453,12 @@ lto_symtab_merge_decls_1 (symtab_node *first)
      cgraph or a varpool node.  */
   if (!prevailing)
     {
-      prevailing = first;
+      for (prevailing = first;
+	   prevailing; prevailing = prevailing->next_sharing_asm_name)
+	if (lto_symtab_symbol_p (prevailing))
+	  break;
+      if (!prevailing)
+	return;
       /* For variables chose with a priority variant with vnode
 	 attached (i.e. from unit where external declaration of
 	 variable is actually used).
-- 
1.7.1

