From 85301853d6403b400c6545b8072d3962d7b66657 Mon Sep 17 00:00:00 2001
From: Max Kellermann <max@duempel.org>
Date: Sat, 11 Oct 2014 21:52:38 +0200
Subject: [PATCH 2/3] ThreadInputStream: call ThreadRead() inside the thread
 instead of Read()

Fixes deadlock bug in the "mms" plugin.
---
 src/input/ThreadInputStream.cxx | 2 +-
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/input/ThreadInputStream.cxx b/src/input/ThreadInputStream.cxx
index 821ce3e..235ed2b 100644
--- a/src/input/ThreadInputStream.cxx
+++ b/src/input/ThreadInputStream.cxx
@@ -88,7 +88,7 @@ ThreadInputStream::ThreadFunc()
 			Unlock();
 
 			Error error;
-			size_t nbytes = Read(w.data, w.size, error);
+			size_t nbytes = ThreadRead(w.data, w.size, error);
 
 			Lock();
 			cond.broadcast();
-- 
2.1.2

